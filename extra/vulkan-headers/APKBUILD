# Contributor: Mark Riedesel <mark@klowner.com>
# Maintainer: Mark Riedesel <mark@klowner.com>
pkgbase=vulkan
pkgname=$pkgbase-headers
pkgver=1.0.20161025
pkgrel=0
pkgdesc="Vulkan development headers"
_pkgname="Vulkan-Docs"
_pkgver="1.0-core-${pkgver##*.}"
url="https://www.khronos.org/vulkan/"
arch="noarch"
license="custom"
depends=""
makedepends="asciidoc python3"
install=""
subpackages="$pkgbase-doc $pkgbase-html-doc:_htmldoc"
source="https://github.com/KhronosGroup/Vulkan-Docs/archive/v${_pkgver}.tar.gz"
builddir="$srcdir/"$_pkgname-$_pkgver

build() {
	cd "$builddir"/doc/specs/vulkan
	# Broken, see https://github.com/KhronosGroup/Vulkan-Docs/issues/367
	LANG="en_US.UTF8" make manpages
	LANG="en_US.UTF8" make manpages
	./makeKHR chunked

	# compress manpages
	find "$builddir"/out/1.0/man/3/*.3 -exec gzip {} \;
}

package() {
	cd "$builddir"

	mkdir -p \
		"$pkgdir"/usr/include/vulkan \
		"$pkgdir"/usr/share/vulkan \
		"$pkgdir"/usr/share/licenses/vulkan

	mv src/vulkan/vk_platform.h "$pkgdir"/usr/include/vulkan/
	mv src/vulkan/vulkan.h "$pkgdir"/usr/include/vulkan/
	mv src/spec/vk.xml "$pkgdir"/usr/share/vulkan/

	cp doc/specs/vulkan/copyright-ccby.txt "$pkgdir"/usr/share/licenses/vulkan/
	cp doc/specs/vulkan/copyright-spec.txt "$pkgdir"/usr/share/licenses/vulkan/
}

_htmldoc() {
	pkgdesc="Vulkan html documentation"
	cd "$builddir"

	mkdir -p "$subpkgdir"/usr/share/doc/vulkan
	mv -v out/1.0/chunked/* "$subpkgdir"/usr/share/doc/vulkan
}

doc() {
	pkgdesc="Vulkan man pages"
	cd "$builddir"

	mkdir -p "$subpkgdir"/usr/share/man/man3
	mv out/1.0/man/3/*.3.gz "$subpkgdir"/usr/share/man/man3/
}

md5sums="7228e1a65d5076999a18f2448525db01  v1.0-core-20161025.tar.gz"
sha256sums="b00cb74bb4efece048072faebb63f5374e68c8494c45de7d7df2d9d74af43134  v1.0-core-20161025.tar.gz"
sha512sums="0aadfd651dfb3ce6a90d3541a05923da04fa461b3a1c6e9d3de27bf42afd2dde4f9ac2f2a0520cd4d3fa611ef3ffeed97bb288c74f88a9bc3c98057140138a74  v1.0-core-20161025.tar.gz"
